## Tips

- 记得用`git pull`和 `git submodule update`确保已经更新为最新版本
- 请确保测试运行在linux环境上
- 有问题可以先浏览一下slack和微信群中的消息记录，可能其他人也遇到过相似的问题
- PC的起始地址为`0x8000_0000`，也就是第一条指令所在的地址
- lab1指令访存和数据访存都会在当前周期就返回（lab1的访存没有延迟）
- 0号寄存器的值恒为零（感兴趣可以看regfile.sv中的实现）
- 指令是32位而数据、数据地址、指令地址都是64位
- 可以利用`$display`进行打印调试，比如`always_ff @(posedge clk) begin $display("%x", pc); end`



## 常见问题

### 环境配置

#### 下载verilator时，`make -j12`后死机

可以使用`make -j4`或者直接`make`，如果使用的是虚拟机，建议更新vmware至16.0版本



### Verilator仿真

#### 测试的代码在哪里看？

测试的代码文件在`ready-to-run`下，对应的.s文件有执行的指令，其中地址部分是文件内偏移量，需要加上`0x8000_0000`才是执行时的地址



#### `/usr/bin/sh: time: command not found`

查看提示信息中是否包含`mingw/mingw32`等字样，如果有的话表明这个是在windows下面直接`make`了，请换到linux环境下再`make`



#### `make test`后出现了ifdef not terminated at EOF？

查看写的每一个`sv`文件，确保其中的 `ifdef/ifndef` 和 `endif`一一对应。



#### 测试之后报错 `No instruction commits for 5000 cycles of core 0. Please check the first instruction.`

请先确保写回阶段的接口与difftest的测试框架相连并且所有的 sv 文件都已保存，然后运行 `make clean`后再`make`对应的测试



#### 未找到头文件`No such file or directory`

这是因为`difftest`依赖一些库，可以尝试`sudo apt install libsdl2-dev zlib1g-dev`，若还是不行，可以尝试查找可能需要的库文件，然后进行安装。



#### `Can't find definition of ***`  

确保所在文件在 `ifdef verilator` 和 `else` 之间的部分中 include了模块所在的文件，并且引用的路径是正确的；同时正确例化模块

```verilog
module_name variable_name( //建议module_name 和 variable_name一致
    .clk(clk), ....
);
```



#### `spike-dasm: command not found`

没有影响，可以不管，~~助教后续可能会改正~~



#### 波形图打不开，或是打开后闪退

波形图目前确实不太完整，助教正在打补丁。建议暂且用display调试。



### Vivado

#### 怎么在vivado中添加源文件？

运行tools选项下的`Run Tcl script`，运行 `vsrc\add_sources.tcl`添加即可。

